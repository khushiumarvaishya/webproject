<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gender Predictor — Single File (HTML + Tailwind + React)</title>
    <!-- Tailwind CDN for quick usage -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (development builds) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel so we can write JSX inside a single HTML file -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-gray-50 min-h-screen flex items-center justify-center p-6">
    <div id="root" class="w-full max-w-2xl"></div>

    <script type="text/babel">
      const { useState } = React;

      function GenderPredictor() {
        const [name, setName] = useState('')
        const [result, setResult] = useState(null)
        const [loading, setLoading] = useState(false)
        const [error, setError] = useState(null)

        // Simple heuristic fallback for offline/no-API: checks common name endings
        function heuristicGuess(nameStr) {
          const n = nameStr.trim().toLowerCase()
          if (!n) return null
          // endings often associated with female names
          const femaleEndings = ['a','e','i','y']
          // endings sometimes associated with male names
          const maleEndings = ['o','r','n','s','d','m']

          const last = n.slice(-1)
          if (femaleEndings.includes(last) && !maleEndings.includes(last)) return {gender: 'female', probability: 0.6, source: 'heuristic'}
          if (maleEndings.includes(last) && !femaleEndings.includes(last)) return {gender: 'male', probability: 0.6, source: 'heuristic'}
          // if ambiguous
          return {gender: 'unknown', probability: 0.5, source: 'heuristic'}
        }

        async function predict() {
          setError(null)
          setResult(null)

          const trimmed = name.trim()
          if (!trimmed) {
            setError('Please enter a name to predict.')
            return
          }

          setLoading(true)

          try {
            // Try Genderize.io (free public API). If blocked or rate-limited, we'll use the heuristic fallback.
            const url = `https://api.genderize.io?name=${encodeURIComponent(trimmed)}`
            const resp = await fetch(url)
            if (!resp.ok) throw new Error('Genderize API returned an error')
            const data = await resp.json()
            // response example: { name: 'peter', gender: 'male', probability: '0.99', count: 3462 }
            if (!data || (!data.gender && data.gender !== null)) {
              // fallback
              const h = heuristicGuess(trimmed)
              setResult({ ...h })
            } else if (data.gender === null) {
              // API didn't have enough data
              const h = heuristicGuess(trimmed)
              setResult({ gender: 'unknown', probability: 0, source: 'genderize (no data) — heuristic suggested', heuristic: h })
            } else {
              setResult({ gender: data.gender, probability: parseFloat(data.probability), count: data.count, source: 'genderize' })
            }
          } catch (e) {
            // network error or CORS: use heuristic fallback and show a helpful message
            const h = heuristicGuess(trimmed)
            setResult({ ...h })
            setError('Failed to reach Genderize API — used local heuristic fallback. (Error: ' + (e.message || e) + ')')
          } finally {
            setLoading(false)
          }
        }

        function handleKey(e) {
          if (e.key === 'Enter') predict()
        }

        return (
          <div className="bg-white shadow-xl rounded-2xl p-8">
            <h1 className="text-2xl font-semibold mb-2">Gender Predictor</h1>
            <p className="text-sm text-gray-500 mb-6">Enter a first name and the app will query <span className="font-medium">Genderize.io</span>. If the API isn't available it falls back to a simple heuristic.</p>

            <div className="flex gap-3">
              <input
                aria-label="First name"
                className="flex-1 rounded-lg border border-gray-200 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-300"
                placeholder="e.g. Priya, Ahmed, Alex"
                value={name}
                onChange={e => setName(e.target.value)}
                onKeyDown={handleKey}
              />

              <button
                onClick={predict}
                disabled={loading}
                className="px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-60"
              >
                {loading ? 'Predicting...' : 'Predict'}
              </button>
            </div>

            {error && (
              <div className="mt-4 text-sm text-red-600">{error}</div>
            )}

            {result && (
              <div className="mt-6 border-t pt-4">
                <div className="flex items-center gap-4">
                  <div className="flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center bg-gray-100 text-xl">
                    {result.gender === 'male' ? '♂' : result.gender === 'female' ? '♀' : '❓'}
                  </div>
                  <div>
                    <div className="text-lg font-medium">Prediction: {String(result.gender).toUpperCase()}</div>
                    <div className="text-sm text-gray-600">Source: {result.source}</div>
                  </div>
                </div>

                <div className="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm">
                  <div className="bg-gray-50 p-3 rounded-lg">
                    <div className="text-xs text-gray-500">Confidence</div>
                    <div className="font-semibold">{(result.probability ?? 0).toString()}</div>
                  </div>

                  <div className="bg-gray-50 p-3 rounded-lg">
                    <div className="text-xs text-gray-500">Count (dataset)</div>
                    <div className="font-semibold">{result.count ?? '—'}</div>
                  </div>

                  <div className="bg-gray-50 p-3 rounded-lg">
                    <div className="text-xs text-gray-500">Heuristic ?</div>
                    <div className="font-semibold">{result.source === 'heuristic' ? 'Yes' : 'No'}</div>
                  </div>
                </div>

                {result.heuristic && (
                  <div className="mt-4 text-sm text-gray-700">Heuristic suggestion: {result.heuristic.gender} (prob ≈ {result.heuristic.probability})</div>
                )}

                <div className="mt-4 text-xs text-gray-500">Note: Name-based gender prediction is probabilistic and may be wrong or culturally biased.</div>
              </div>
            )}

            <div className="mt-6 text-xs text-gray-400">Tip: try names from different languages/regions to see how predictions change.</div>

            <footer className="mt-6 text-center text-xs text-gray-300">Built with React + Tailwind • Uses Genderize.io (if reachable)</footer>
          </div>
        )
      }

      // Mount
      ReactDOM.createRoot(document.getElementById('root')).render(<GenderPredictor />)
    </script>
  </body>
</html>
